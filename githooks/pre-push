#!/bin/sh

echo "ğŸš€ Ejecutando verificaciones solo en archivos que se enviarÃ¡n..."

# Obtener los archivos modificados en los commits que se estÃ¡n enviando
FILES_TO_CHECK="$(git diff --name-only "origin/$(git rev-parse --abbrev-ref HEAD)..HEAD" -- '*.java')"

if [ -z "$FILES_TO_CHECK" ]; then
    echo "âœ… No hay archivos Java para verificar en este push"
    exit 0
fi

echo "ğŸ” Archivos que se enviarÃ¡n y se verificarÃ¡n:"
echo "$FILES_TO_CHECK"

echo "ğŸ§¹ Ejecutando checkstyle..."
if ! ./gradlew checkstyleMain -P checkstyle.includes="$FILES_TO_CHECK"; then
  echo "âŒ Checkstyle fallÃ³ en archivos que se estÃ¡n enviando"
  echo "ğŸ’¡ Ejecuta: ./gradlew checkstyleMain para ver detalles"
  exit 1
fi

echo "ğŸ§ª Ejecutando tests..."
if ! ./gradlew test; then
  echo "âŒ Algunos tests fallaron"
  exit 1
fi

echo "ğŸ› ï¸ Verificando compilaciÃ³n..."
if ! ./gradlew compileJava; then
    echo "âŒ Error de compilaciÃ³n"
    exit 1
fi

echo "âœ… Todas las verificaciones pasaron. Realizando push..."
exit 0